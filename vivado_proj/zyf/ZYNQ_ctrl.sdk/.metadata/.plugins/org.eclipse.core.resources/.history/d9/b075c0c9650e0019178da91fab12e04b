/*
 * uart_cam.c
 *
 *  Created on: 2019年1月2日
 *      Author: admin
 */

#include "uart_cam.h"
#include "flag.h"
#include "DronePara.h"

#define UARTLITE_CAM_DEVICE_ID 	XPAR_UARTLITE_1_DEVICE_ID
#define UARTLITE_CAM_INT_ID		XPAR_FABRIC_UARTLITE_1_VEC_ID
#define DATA_LEN				8

extern XUartLite UartCam;
extern XScuGic InterruptController;
extern flag FlagInstance;
extern BallInfo Ball_Info;		//小球数据

static u8 ReceiveBuffer[8] = {0};

void CamRecvHandler(void *CallBackRef, unsigned int EventData)
{
//	TotalReceivedCount = EventData;
	if(EventData == DATA_LEN) {
		FlagInstance.uart_cam_recv = 1;
	}
	xil_printf("uart receive event\r\n");
}

void CamSendHandler(void *CallBackRef, unsigned int EventData)
{
//	TotalSentCount = EventData;
//	xil_printf("uart send event\r\n");
}

void InitUartCam(void) {
	InitUartLite(&UartCam, UARTLITE_CAM_DEVICE_ID, UARTLITE_CAM_INT_ID, &InterruptController, CamSendHandler, CamRecvHandler);

    //打开uart接收
    XUartLite_Recv(&UartCam, ReceiveBuffer, DATA_LEN);
}

void RecvUartCam(void) {

    //打开uart接收
    XUartLite_Recv(&UartCam, ReceiveBuffer, DATA_LEN);
}
